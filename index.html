<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Private Novel Reader</title>
  <link rel="icon" href="data:,">

  <style>
    :root {
      --bg: #ffffff;
      --text: #111827;
      --panel: #f3f4f6;
      --accent: #2563eb;
    }

    body.dark-1 {
      --bg: #0f172a;
      --text: #e5e7eb;
      --panel: #020617;
      --accent: #38bdf8;
    }

    body.dark-2 {
      --bg: #0b0b0b;
      --text: #eaeaea;
      --panel: #121212;
      --accent: #22c55e;
    }

    body {
      margin: 0;
      font-family: Georgia, serif;
      display: flex;
      height: 100vh;
      background: var(--bg);
      color: var(--text);
      transition: background 0.2s, color 0.2s;
    }

    #sidebar {
      width: 300px;
      background: var(--panel);
      border-right: 1px solid #ddd;
      padding: 14px;
      overflow-y: auto;
    }

    #main {
      flex: 1;
      padding: 20px 28px;
      overflow-y: auto;
      max-width: 900px;
      margin: 0 auto;
    }

    h1, h2, h3 { margin-top: 0; }

    button {
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: var(--accent);
      color: white;
      font-size: 14px;
    }

    .secondary-btn {
      background: none;
      color: var(--text);
      border: 1px solid #ccc;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 16px;
    }

    .chapter, .novel {
      padding: 8px 10px;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 4px;
    }

    .chapter:hover, .novel:hover { background: rgba(0,0,0,0.05); }
    .active { background: var(--accent); color: white; }

    #content {
      white-space: pre-line;
    }

    textarea {
      width: 100%;
      min-height: 320px;
      padding: 14px;
      box-sizing: border-box;
    }

    select {
      padding: 6px;
    }

    #editBtn { margin-top: 30px; display: none; }

    @media (max-width: 768px) {
      body { flex-direction: column; }
      #sidebar { width: 100%; border-right: none; border-bottom: 1px solid #ddd; }
      #main { max-width: 100%; }
    }
  </style>
</head>
<body>

<div id="sidebar">
  <h3>üìö Novels</h3>
  <button id="addNovelBtn">+ Add Novel</button>
  <div id="novelList"></div>

  <hr>

  <h3>üìñ Chapters</h3>
  <button id="addChapterBtn" disabled>+ Add Chapter</button>
  <div id="chapterList"></div>
</div>

<div id="main">
  <div class="toolbar">
    <button id="themeBtn" class="secondary-btn">üåì</button>
    <button id="fontInc" class="secondary-btn">A+</button>
    <button id="fontDec" class="secondary-btn">A-</button>
    <button id="lineInc" class="secondary-btn">‚Üï+</button>
    <button id="lineDec" class="secondary-btn">‚Üï-</button>

    <select id="fontFamily">
      <option value="Georgia, serif">Georgia (Serif)</option>
      <option value="Times New Roman, serif">Times New Roman</option>
      <option value="Merriweather, serif">Merriweather</option>
      <option value="Arial, sans-serif">Arial</option>
      <option value="Helvetica, sans-serif">Helvetica</option>
      <option value="Verdana, sans-serif">Verdana</option>
      <option value="Courier New, monospace">Courier New</option>
    </select>
  </div>

  <h1 id="title"></h1>
  <div id="content"></div>

  <div id="editor" style="display:none;">
    <textarea id="editorText"></textarea>
    <br><br>
    <button id="saveBtn">Save</button>
  </div>

  <button id="editBtn">‚úèÔ∏è Edit Chapter</button>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const SUPABASE_URL = 'https://sojqynzunkacykxqhkgy.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNvanF5bnp1bmthY3lreHFoa2d5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNDY5ODksImV4cCI6MjA4MTYyMjk4OX0.6gyYxbsRxoQQ97xVf1ENCtz0Qt1AlLS0NUr5-BDibSk';
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const novelList = document.getElementById('novelList');
  const chapterList = document.getElementById('chapterList');
  const titleEl = document.getElementById('title');
  const contentEl = document.getElementById('content');
  const editor = document.getElementById('editor');
  const editorText = document.getElementById('editorText');
  const editBtn = document.getElementById('editBtn');
  const addChapterBtn = document.getElementById('addChapterBtn');

  let currentNovel = null;
  let currentChapter = null;
  let fontSize = 18;
  let lineHeight = 1.8;
  let themeIndex = 0;
  const themes = ['', 'dark-1', 'dark-2'];

  function applyTypography() {
    contentEl.style.fontSize = fontSize + 'px';
    contentEl.style.lineHeight = lineHeight;
    contentEl.style.fontFamily = document.getElementById('fontFamily').value;
    editorText.style.fontSize = fontSize + 'px';
    editorText.style.lineHeight = lineHeight;
    editorText.style.fontFamily = document.getElementById('fontFamily').value;
  }

  async function loadNovels() {
    const { data } = await supabase.from('novels').select('*').order('created_at');
    novelList.innerHTML = '';

    data.forEach(n => {
      const div = document.createElement('div');
      div.className = 'novel';
      div.textContent = n.title;
      div.onclick = () => openNovel(n, div);
      novelList.appendChild(div);
    });
  }

  async function openNovel(novel, el) {
    document.querySelectorAll('.novel').forEach(n => n.classList.remove('active'));
    el.classList.add('active');

    currentNovel = novel;
    addChapterBtn.disabled = false;
    titleEl.textContent = '';
    contentEl.textContent = '';
    editBtn.style.display = 'none';
    editor.style.display = 'none';

    const { data } = await supabase
      .from('chapters')
      .select('*')
      .eq('novel_id', novel.id)
      .order('created_at');

    chapterList.innerHTML = '';
    data.forEach(ch => {
      const div = document.createElement('div');
      div.className = 'chapter';
      div.textContent = ch.title;
      div.onclick = () => openChapter(ch, div);
      chapterList.appendChild(div);
    });
  }

  function openChapter(ch, el) {
    document.querySelectorAll('.chapter').forEach(c => c.classList.remove('active'));
    el.classList.add('active');

    currentChapter = ch;
    titleEl.textContent = ch.title;
    contentEl.textContent = ch.text || '';
    editorText.value = ch.text || '';

    editor.style.display = 'none';
    editBtn.style.display = 'block';
    applyTypography();
  }

  document.getElementById('addNovelBtn').onclick = async () => {
    const title = prompt('Novel title');
    if (!title) return;
    await supabase.from('novels').insert({ title });
    loadNovels();
  };

  addChapterBtn.onclick = async () => {
    const title = prompt('Chapter title');
    if (!title) return;
    await supabase.from('chapters').insert({ title, novel_id: currentNovel.id, text: '' });
    openNovel(currentNovel, document.querySelector('.novel.active'));
  };

  document.getElementById('saveBtn').onclick = async () => {
    await supabase.from('chapters').update({ text: editorText.value }).eq('id', currentChapter.id);
    currentChapter.text = editorText.value;
    contentEl.textContent = editorText.value;
    editor.style.display = 'none';
    editBtn.style.display = 'block';
  };

  editBtn.onclick = () => {
    editor.style.display = 'block';
    editBtn.style.display = 'none';
    editorText.focus();
  };

  document.getElementById('fontInc').onclick = () => { fontSize++; applyTypography(); };
  document.getElementById('fontDec').onclick = () => { fontSize--; applyTypography(); };
  document.getElementById('lineInc').onclick = () => { lineHeight += 0.1; applyTypography(); };
  document.getElementById('lineDec').onclick = () => { lineHeight -= 0.1; applyTypography(); };
  document.getElementById('fontFamily').onchange = applyTypography;

  document.getElementById('themeBtn').onclick = () => {
    document.body.className = themes[++themeIndex % themes.length];
  };

  loadNovels();
</script>

</body>
</html>
